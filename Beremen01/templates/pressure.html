<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–î–∞–≤–ª–µ–Ω–∏–µ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, sans-serif;
      background: #f2f3f5;
      color: #333;
      max-width: 420px;
      margin-left: auto;
      margin-right: auto;
    }
    h2 {
      margin-top: 24px;
      font-size: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .info-block {
      background: #fff;
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      margin-bottom: 20px;
    }
    .pressure-inputs {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 10px;
    }
    .pressure-inputs input {
      width: 80px;
      font-size: 24px;
      padding: 6px;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 10px;
    }
    .submit-btn {
      margin-top: 12px;
      background: #4a90e2;
      color: white;
      border: none;
      padding: 10px 24px;
      border-radius: 24px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
    }
    .edit-btn {
      font-size: 16px;
      background: none;
      border: none;
      color: #888;
      cursor: pointer;
      margin-left: 10px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>

  <div style="display: flex; align-items: center; margin-bottom: 12px; position: relative;">
    <button onclick="goBack()" style="background: none; border: none; font-size: 16px; color: #4f8fba; cursor: pointer; position: absolute; left: 0;">
      ‚Üê –ù–∞–∑–∞–¥
    </button>
    <h2 style="margin: 0 auto; text-align: center;">–î–∞–≤–ª–µ–Ω–∏–µ</h2>
  </div>

  <!-- –ë–ª–æ–∫: –∑–Ω–∞–µ—Ç–µ –ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ -->
  <div class="info-block" id="questionBlock">
    <p>–í—ã –∑–Ω–∞–µ—Ç–µ —Å–≤–æ—ë –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ –¥–æ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏?</p>
    <button class="submit-btn" onclick="answerNormalPressure(true)">–î–∞</button>
    <button class="submit-btn" onclick="answerNormalPressure(false)">–ù–µ—Ç</button>
  </div>

  <!-- –ë–ª–æ–∫: –≤–≤–æ–¥ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è -->
  <div class="info-block hidden" id="normalPressureBlock">
    <p>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ</p>
    <div class="pressure-inputs">
      <input type="number" id="normalSys" placeholder="–í–µ—Ä—Ö–Ω." min="80" max="200" />
      <input type="number" id="normalDia" placeholder="–ù–∏–∂." min="50" max="130" />
    </div>
    <button class="submit-btn" onclick="submitNormalPressure()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>

  <!-- –ë–ª–æ–∫: –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è -->
  <div class="info-block hidden" id="normalDisplayBlock">
    <p>
      üßæ –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ: <strong id="normalDisplayText"></strong>
      <button class="edit-btn" onclick="editNormalPressure()">‚úèÔ∏è</button>
    </p>
  </div>

  <!-- –ë–ª–æ–∫: –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –≤–≤–æ–¥ –¥–∞–≤–ª–µ–Ω–∏—è -->
  <div class="info-block hidden" id="todayBlock">
    <p id="todayLabel">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –¥–∞–≤–ª–µ–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è</p>
    <div class="pressure-inputs">
      <input type="number" id="todaySys" placeholder="–í–µ—Ä—Ö–Ω." min="80" max="200" />
      <input type="number" id="todayDia" placeholder="–ù–∏–∂." min="50" max="130" />
    </div>
    <button class="submit-btn" onclick="submitTodayPressure()">–í–Ω–µ—Å—Ç–∏</button>
  </div>

  <!-- –ë–ª–æ–∫: –∞–Ω–∞–ª–∏–∑ -->
  <div class="info-block hidden" id="statusBlock">
    <p id="pressureStatus">‚Äî</p>
  </div>

  <!-- –ì—Ä–∞—Ñ–∏–∫ -->
  <canvas id="pressureChart" class="hidden" style="max-width: 100%; margin-bottom: 20px;"></canvas>

  <!-- –°—Ç–∞—Ç—å—è -->
  <h2>–û –¥–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–∏ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏</h2>
  <div class="info-block">
    <p><strong>ü´Ä –ü–æ—á–µ–º—É –¥–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–∫ –≤–∞–∂–Ω–æ –≤–æ –≤—Ä–µ–º—è –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏?</strong></p>
    <p>–í–æ –≤—Ä–µ–º—è –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏ –≤ –æ—Ä–≥–∞–Ω–∏–∑–º–µ –∂–µ–Ω—â–∏–Ω—ã —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –æ–±—ä—ë–º –∫—Ä–æ–≤–∏ –∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫—Ä—É–≥ –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏—è ‚Äî –ø–ª–∞—Ü–µ–Ω—Ç–∞—Ä–Ω—ã–π. –≠—Ç–æ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–æ –æ–Ω–∏ –º–æ–≥—É—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ.</p>
    <p><strong>üí° –ß—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–æ—Ä–º–æ–π?</strong><br>
    –õ—É—á—à–µ –≤—Å–µ–≥–æ, –µ—Å–ª–∏ –¥–∞–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ, –∫–∞–∫–∏–º –±—ã–ª–æ –¥–æ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏. –û–±—ã—á–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è <strong>–Ω–µ –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 10%</strong> –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è.</p>

    <p><strong>üî∫ –ï—Å–ª–∏ –¥–∞–≤–ª–µ–Ω–∏–µ –ø–æ–≤—ã—à–µ–Ω–æ</strong></p>
    <p><u>–§–∞–∫—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞:</u></p>
    <ul>
      <li>–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ –¥–æ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏;</li>
      <li>–∏–∑–±—ã—Ç–æ—á–Ω—ã–π –≤–µ—Å;</li>
      <li>–æ—Å–ª–æ–∂–Ω–µ–Ω–∏—è –≤ –ø—Ä–æ—à–ª—ã—Ö –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—è—Ö;</li>
      <li>–≥–æ—Ä–º–æ–Ω–∞–ª—å–Ω—ã–µ —Å–±–æ–∏;</li>
      <li>–∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è –ø–æ—á–µ–∫.</li>
    </ul>
    <p><u>–°–∏–º–ø—Ç–æ–º—ã:</u> –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å, —à—É–º –≤ —É—à–∞—Ö, –ø—Ä–∏–ª–∏–≤—ã –∂–∞—Ä–∞, —É—Ö—É–¥—à–µ–Ω–∏–µ –∑—Ä–µ–Ω–∏—è, –Ω–æ –∏–Ω–æ–≥–¥–∞ ‚Äî –≤–æ–æ–±—â–µ –±–µ–∑ —Å–∏–º–ø—Ç–æ–º–æ–≤. –ü–æ—ç—Ç–æ–º—É <strong>—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ ‚Äî –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–± –∫–æ–Ω—Ç—Ä–æ–ª—è</strong>.</p>
    <p><em>–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –¥–æ 20 –Ω–µ–¥–µ–ª—å ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –≥–∏–ø–µ—Ä—Ç–æ–Ω–∏—è. –ü–æ—Å–ª–µ ‚Äî —Å–ª–µ–¥–∏—Ç–µ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –≥–µ—Å—Ç–æ–∑–∞ (–ø—Ä–µ—ç–∫–ª–∞–º–ø—Å–∏–∏).</em></p>

    <p><strong>üîª –ï—Å–ª–∏ –¥–∞–≤–ª–µ–Ω–∏–µ –ø–æ–Ω–∏–∂–µ–Ω–æ</strong></p>
    <p>–ù–∞ —Ä–∞–Ω–Ω–∏—Ö —Å—Ä–æ–∫–∞—Ö –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å —Å–ª–∞–±–æ—Å—Ç—å, –≥–æ–ª–æ–≤–æ–∫—Ä—É–∂–µ–Ω–∏–µ, –∑–≤–æ–Ω –≤ —É—à–∞—Ö, –æ–±–º–æ—Ä–æ–∫–∏. –≠—Ç–æ —Ç–æ–∂–µ –≤–∞–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å ‚Äî –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–π –≥–∏–ø–æ—Ç–æ–Ω–∏–∏ —Ä–µ–±—ë–Ω–∫—É –º–æ–∂–µ—Ç –Ω–µ —Ö–≤–∞—Ç–∞—Ç—å –∫–∏—Å–ª–æ—Ä–æ–¥–∞.</p>

    <p><strong>üßò‚Äç‚ôÄÔ∏è –ö–∞–∫ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –Ω–æ—Ä–º—É?</strong></p>
    <ul>
      <li>—Å–ª–µ–¥–∏—Ç—å –∑–∞ –¥–∞–≤–ª–µ–Ω–∏–µ–º –µ–∂–µ–¥–Ω–µ–≤–Ω–æ;</li>
      <li>–±–æ–ª—å—à–µ –≥—É–ª—è—Ç—å –∏ –æ—Ç–¥—ã—Ö–∞—Ç—å;</li>
      <li>–ø–∏—Ç–∞—Ç—å—Å—è —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ (–º–µ–Ω—å—à–µ —Å–æ–ª–∏);</li>
      <li>–±—Ä–æ—Å–∏—Ç—å –≤—Ä–µ–¥–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏;</li>
      <li>—Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ–±—â–∞—Ç—å—Å—è —Å –≤—Ä–∞—á–æ–º.</li>
    </ul>

    <p><strong>üìå –ì–ª–∞–≤–Ω–æ–µ:</strong> –¥–∞–≤–ª–µ–Ω–∏–µ –º–æ–∂–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å ‚Äî –∏ —ç—Ç–æ —É–∂–µ –≤–∞–∂–Ω—ã–π —à–∞–≥ –∫ –∑–¥–æ—Ä–æ–≤–æ–π –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏ üíô</p>

    <p style="font-size: 13px; color: #777;">üìù <a href="https://minzdrav.med04.ru/about/info/news/8963/?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">–ò—Å—Ç–æ—á–Ω–∏–∫: –ú–∏–Ω–∑–¥—Ä–∞–≤ –†–µ—Å–ø—É–±–ª–∏–∫–∏ –ö–∞–ª–º—ã–∫–∏—è</a></p>
  </div>

  <script>
    const questionBlock = document.getElementById("questionBlock");
    const normalPressureBlock = document.getElementById("normalPressureBlock");
    const normalDisplayBlock = document.getElementById("normalDisplayBlock");
    const todayBlock = document.getElementById("todayBlock");
    const statusBlock = document.getElementById("statusBlock");
    const chartCanvas = document.getElementById("pressureChart");
    const normalDisplayText = document.getElementById("normalDisplayText");
    const pressureStatus = document.getElementById("pressureStatus");

    function answerNormalPressure(know) {
      questionBlock.classList.add("hidden");
      if (know) {
        normalPressureBlock.classList.remove("hidden");
      } else {
        alert("–•–æ—Ä–æ—à–æ! –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –≤–≤–µ—Å—Ç–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é.");
      }
    }

    const userId = sessionStorage.getItem("tg_user_id");

    function submitNormalPressure() {
      const sys = parseInt(document.getElementById("normalSys").value);
      const dia = parseInt(document.getElementById("normalDia").value);
      if (!sys || !dia) return alert("–í–≤–µ–¥–∏—Ç–µ –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è –¥–∞–≤–ª–µ–Ω–∏—è");

      localStorage.setItem("normal_sys", sys);
      localStorage.setItem("normal_dia", dia);
      fetch("/save_normal_pressure", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ user_id: userId, systolic: sys, diastolic: dia })
      });
      normalPressureBlock.classList.add("hidden");

      renderNormalDisplay(sys, dia);
      todayBlock.classList.remove("hidden");
    }

    function renderNormalDisplay(sys, dia) {
      normalDisplayText.textContent = `${sys}/${dia}`;
      normalDisplayBlock.classList.remove("hidden");
    }

    function editNormalPressure() {
      normalPressureBlock.classList.remove("hidden");
    }

    function goBack() {
      window.location.href = "/main";
    }

    function submitTodayPressure() {
      const sys = parseInt(document.getElementById("todaySys").value);
      const dia = parseInt(document.getElementById("todayDia").value);
      if (!sys || !dia) return alert("–í–≤–µ–¥–∏—Ç–µ –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è");

      const normSys = parseInt(localStorage.getItem("normal_sys"));
      const normDia = parseInt(localStorage.getItem("normal_dia"));

      const date = new Date().toISOString().slice(0, 10);
      localStorage.setItem("pressure_date", date);
      localStorage.setItem("today_sys", sys);
      localStorage.setItem("today_dia", dia);

      fetch("/save_pressure", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ user_id: userId, systolic: sys, diastolic: dia, date })
      });

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É
      if (sys < 90 || dia < 60) {
        pressureStatus.textContent = "üîª –ù–∏–∑–∫–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ, –ø—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å –≤—Ä–∞—á–æ–º.";
        localStorage.setItem("pressure_status_text", pressureStatus.textContent);
      } else if (sys > 140 || dia > 90) {
        pressureStatus.textContent = "üî∫ –í—ã—Å–æ–∫–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ, –ø—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å –≤—Ä–∞—á–æ–º.";
        localStorage.setItem("pressure_status_text", pressureStatus.textContent);
      } else {
        const sysDiff = (sys - normSys) / normSys;
        const diaDiff = (dia - normDia) / normDia;

        if (Math.abs(sysDiff) < 0.1 && Math.abs(diaDiff) < 0.1) {
          pressureStatus.textContent = "‚úÖ –î–∞–≤–ª–µ–Ω–∏–µ –≤ –Ω–æ—Ä–º–µ!";
        } else if (sysDiff > 0.1 || diaDiff > 0.1) {
          pressureStatus.textContent = "‚ÑπÔ∏è –î–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–º–Ω–æ–≥–æ –≤—ã—à–µ –Ω–æ—Ä–º—ã.";
        } else if (sysDiff < -0.1 || diaDiff < -0.1) {
          pressureStatus.textContent = "‚ÑπÔ∏è –î–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–º–Ω–æ–≥–æ –Ω–∏–∂–µ –Ω–æ—Ä–º—ã.";
        } else {
          pressureStatus.textContent = "‚ÑπÔ∏è –î–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –Ω–æ—Ä–º—ã.";
        }

        localStorage.setItem("pressure_status_text", pressureStatus.textContent);
      }

      statusBlock.classList.remove("hidden");
      chartCanvas.classList.remove("hidden");
      localStorage.setItem("pressure_date", date);
      localStorage.setItem("pressure_chart_shown", "1");
      loadAndRenderChart();

      // –¢—É—Ç –≤—ã–∑–æ–≤–µ—à—å `renderChart()` —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    }

    window.addEventListener("DOMContentLoaded", async () => {
      const sys = localStorage.getItem("normal_sys");
      const dia = localStorage.getItem("normal_dia");
      const userId = sessionStorage.getItem("tg_user_id");

      if (!sys || !dia) return;

      questionBlock.classList.add("hidden");
      renderNormalDisplay(sys, dia);
      todayBlock.classList.remove("hidden");

      // üî• [–ù–û–í–û–ï] –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –¥–∞–≤–ª–µ–Ω–∏–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
      try {
        const res = await fetch(`/load_pressure_data?user_id=${userId}`);
        const data = await res.json();
        if (data.entries && data.entries.length > 0) {
          const [lastDate, lastSys, lastDia] = data.entries[data.entries.length - 1];

          const today = new Date().toISOString().slice(0, 10);
          const sysInput = document.getElementById("todaySys");
          const diaInput = document.getElementById("todayDia");
          const btn = document.querySelector("#todayBlock .submit-btn");

          // üî• [–ò–ó–ú–ï–ù–Å–ù–ù–´–ô –£–°–õ–û–í–ù–´–ô –ë–õ–û–ö]
          if (lastDate === today) {
            sysInput.value = lastSys;
            diaInput.value = lastDia;
            btn.textContent = "–ò–∑–º–µ–Ω–∏—Ç—å";
          } else {
            sysInput.value = "";
            diaInput.value = "";
            btn.textContent = "–í–Ω–µ—Å—Ç–∏";
          }

          // üî• [–ù–û–í–û–ï] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–∞–≤–ª–µ–Ω–∏—è
          const savedStatus = localStorage.getItem("pressure_status_text");
          pressureStatus.textContent = (lastDate === today && savedStatus)
            ? savedStatus
            : getStatusTextByLastDate(lastDate);
          statusBlock.classList.remove("hidden");

          // üî• [–ù–û–í–û–ï] –ì—Ä–∞—Ñ–∏–∫
          chartCanvas.classList.remove("hidden");
          localStorage.setItem("pressure_chart_shown", "1");
          loadAndRenderChart();
        }
      } catch (e) {
        console.warn("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–≤–ª–µ–Ω–∏—è –∏–∑ –±–∞–∑—ã", e);
      }
    });

    function loadAndRenderChart() {
      fetch(`/load_pressure_data?user_id=${userId}`)
        .then(res => res.json())
        .then(data => {
          if (!data.entries || data.entries.length < 1) return;

          const normSys = parseInt(localStorage.getItem("normal_sys"));
          const normDia = parseInt(localStorage.getItem("normal_dia"));

          const userId = sessionStorage.getItem("tg_user_id");

          // –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏
          fetch(`/load_user_data?user_id=${userId}`)
            .then(res => res.json())
            .then(userData => {
              const startDate = userData.start_date || userData.weights?.[0]?.[1]; // –µ—Å–ª–∏ –µ—Å—Ç—å –≤–µ—Å, –±–µ—Ä—ë–º –¥–∞—Ç—É –ø–µ—Ä–≤–æ–≥–æ –≤–µ—Å–∞

              const labels = [startDate, ...data.entries.map(row => row[0])];
              const systolicData = [normSys, ...data.entries.map(row => row[1])];
              const diastolicData = [normDia, ...data.entries.map(row => row[2])];

    new Chart(chartCanvas, {
      type: 'line',
      data: {
        labels,
        datasets: [
          {
            label: '–í–µ—Ä—Ö–Ω–µ–µ',
            data: systolicData,
            borderWidth: 2,
            tension: 0.3
          },
          {
            label: '–ù–∏–∂–Ω–µ–µ',
            data: diastolicData,
            borderWidth: 2,
            tension: 0.3
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'top'
          }
        },
        scales: {
          y: {
            suggestedMin: 60,
            suggestedMax: 160
          }
        }
      }
    });
    });
    });
    }
  </script>
  <div class="disclaimer" style="font-size: 12px; color: #999; text-align: center; margin-top: 32px;">
    ‚ö†Ô∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É.
  </div>
</body>
</html>